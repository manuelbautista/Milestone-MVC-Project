@using System.Globalization
@model DCS.DAL.GetDetailForProject_Result
@{

    ViewBag.Title = "Milestone";
   

}
<link href='@Url.Content("~/Content/newstyle.css")' rel="stylesheet" />
<link href='@Url.Content("~/Content/responsive.css")' rel="stylesheet" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
<style>
    .legendmilestone {
        display: inline-block;
        padding: 5px;
        font-size: 8px;
        margin-bottom: 10px;
        margin-right: 7px;
        border-radius: 6px;
        color: #fff;
        float: right;
    }
</style>
@using (Html.BeginForm("EditMilestone", "Project", FormMethod.Post, new { @id = "form1" }))
{
      <textarea style="display:none" id="PDFdiv" name="PDFdiv" ></textarea>
    <div class="row">
        <div class="col-lg-12 col-md-12">
            <div class="projectlist clstopmargin" >

                <div class="panel panel-default">
                    <div class="panel-heading pnlwithrightbutton">
                        <span class="spnpnlheading">Project Status</span>
                        <a class="btn btn-primary pull-right" href="@Url.Action("index", "project")" style="color:white">Back</a>
                    </div>
                    <div class="panel-body" id="exportPdfDiv">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                Project Detail
                            </div>
                            <div class="panel-body nopadding">
                                <div class="row">
                                    <div class="col-md-12 col-sm-12 col-xs-12">
                                        <div class="form-group" style="margin-top: 15px;">
                                            <div class="col-lg-2 col-md-2 col-sm-6 col-xs-6 form-group">Project No:</div>
                                            <div class="col-lg-2 col-md-2 col-sm-6 col-xs-6 form-group">@Model.ProjectNumber </div>
                                            <div class="col-lg-2 col-md-2 col-sm-6 col-xs-6 form-group">
                                                Project Name:
                                            </div>
                                            <div class="col-lg-2 col-md-2 col-sm-6 col-xs-6 form-group">
                                                @Model.Name
                                            </div>
                                            <div class="col-lg-2 col-md-2 col-sm-6 col-xs-6 form-group">
                                                ETO Playbook:
                                            </div>
                                            <div class="col-lg-2 col-md-2 col-sm-6 col-xs-6 form-group">
                                                @Model.ETOPlaybooks
                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12 col-sm-12 col-xs-12">
                                        <div class="form-group">
                                            <div class="col-lg-2 col-md-2 col-sm-6 col-xs-6 form-group">Anthem Owner:</div>
                                            <div class="col-lg-2 col-md-2 col-sm-6 col-xs-6 form-group">
                                                @Model.ProjectOwnerANTMName
                                            </div>
                                          
                                            <div class="col-lg-2 col-md-2 col-sm-6 col-xs-7 form-group">Project Co-Owner/ Partner:</div>
                                            <div class="col-lg-2 col-md-2 col-sm-6 col-xs-5 form-group">
                                                @Model.ProjectOwnerExternalName
                                            </div>


                                            <div class="col-lg-2 col-md-2 col-sm-6 col-xs-6 form-group">Overall % Comp:</div>
                                            <div class="col-lg-2 col-md-2 col-sm-6 col-xs-6 form-group">
                                                <span id="spn-overall-complete"></span>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12 col-sm-12 col-xs-12">

                                        <div class="form-group">
                                            <div class="col-lg-2 col-md-2 col-sm-6 col-xs-6 form-group">Project Start :</div>
                                            <div id="proj-startdate" class="col-lg-2 col-md-2  col-sm-6 col-xs-6 form-group">
                                                @*@Model.StartDate.Value..ToShortDateString()*@
                                                @Model.StartDate.Value.ToString("MM/dd/yyyy", CultureInfo.InvariantCulture)
                                            </div>
                                            <div class="col-lg-2 col-md-2 col-sm-6 col-xs-6 form-group">Project End :</div>
                                            <div id="proj-enddate" class="col-lg-2 col-md-2 col-sm-6 col-xs-6 form-group">
                                                @Model.EndDate.Value.ToString("MM/dd/yyyy", CultureInfo.InvariantCulture)
                                            </div>

                                            @Html.HiddenFor(m => m.ID)
                                            <div class="col-lg-2 col-md-2 col-sm-6 col-xs-6 form-group">
                                                <input type="hidden" id="hdn-proj-startdate" value="@Model.StartDate.Value.ToShortDateString()" />
                                            </div>
                                            <div class="col-lg-2 col-md-2 col-sm-6 col-xs-6 form-group">
                                                <input type="hidden" id="hdn-proj-enddate" value="@Model.EndDate.Value.ToShortDateString()" />
                                            </div>

                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                Add Email Addresses &nbsp;&nbsp;<input type="checkbox" id="emailchkbox" name="emailchkbox" />
                            </div>
                            <div class="panel-body nopadding">
                                <div id="emailDiv" class="col-md-12 col-sm-12 table-responsive pull-left" style="display: none">
                                    <table id="tblEmail" class="table">
                                        <thead>
                                            <tr>
                                                <th style="width: 50px;">#</th>
                                                <th>Email</th>
                                            </tr>
                                        </thead>
                                        <tbody class="clsemailrow"></tbody>
                                    </table>
                                </div>

                                <div id="emailListDiv" class="col-md-12 col-sm-12 table-responsive pull-left" style="display: none">
                                    <table class="table" id="table-email-detail">
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>Name</th>
                                            </tr>
                                        </thead>
                                        <tbody id="email-detail">
                                            <tr>
                                                <td colspan="2">No Email(s) found.</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="panel panel-default">
                            <div class="panel-heading">
                                Status Detail
                            </div>
                            <div class="panel-body nopadding">
                                <div class="form-group" style="margin-top: 15px;">
                                    <div class="col-lg-2 col-md-2 col-sm-3 col-xs-12">
                                        Select Scope
                                        @Html.DropDownListFor(x => x.ScopeId, (IEnumerable<SelectListItem>)ViewBag.RequirementList, new { @class = "form-control", onchange = "return updateragstatus(this)" })
                                        @Html.ValidationMessageFor(x => x.ScopeId)
                                        @*@Html.DropDownList("ScopeId", (IEnumerable<SelectListItem>)ViewBag.RequirementList, "-Select-", new { @class = "form-control" , onchange="return updateragstatus(this)" })*@
                                    </div>
                                    <div class="col-lg-2 col-md-2 col-sm-3 col-xs-12">
                                        Select Schedule
                                        @Html.DropDownListFor(x => x.ScheduleId, (IEnumerable<SelectListItem>)ViewBag.RequirementList, new { @class = "form-control", onchange = "return updateragstatus(this)" })
                                        @Html.ValidationMessageFor(x => x.ScheduleId)
                                        @*@Html.DropDownList("ScheduleId", (IEnumerable<SelectListItem>)ViewBag.RequirementList, "-Select-", new { @class = "form-control", onchange = "return updateragstatus(this)" })*@
                                    </div>
                                    <div class="col-lg-2 col-md-2 col-sm-3 col-xs-12">
                                        Select Resource
                                        @Html.DropDownListFor(x => x.ResourcesId, (IEnumerable<SelectListItem>)ViewBag.RequirementList, new { @class = "form-control", onchange = "return updateragstatus(this)" })
                                        @Html.ValidationMessageFor(x => x.ResourcesId)
                                        @*@Html.DropDownList("ResourcesId", (IEnumerable<SelectListItem>)ViewBag.RequirementList, "-Select-", new { @class = "form-control", onchange = "return updateragstatus(this)" })*@
                                    </div>
                                    <div class="col-lg-2 col-md-2 col-sm-3 col-xs-12">
                                        Select Financial
                                        @Html.DropDownListFor(x => x.FinancialId, (IEnumerable<SelectListItem>)ViewBag.RequirementList, new { @class = "form-control", onchange = "return updateragstatus(this)" })
                                        @Html.ValidationMessageFor(x => x.FinancialId)

                                        @*@Html.DropDownList("FinancialId", (IEnumerable<SelectListItem>)ViewBag.RequirementList, "-Select-", new { @class = "form-control", onchange = "return updateragstatus(this)" })*@
                                    </div>
                                    <div class="col-lg-2 col-md-2  col-sm-12 col-xs-12">
                                        Project Status:
                                    </div>
                                    <div class="col-lg-2 col-md-2 col-sm-12 col-xs-12 clsrag">
                                        &nbsp;
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <div class="row">

                                    <div class="col-lg-6 col-md-6 col-sm-4 col-xs-12 ">
                                        Milestone Detail
                                    </div>
                                    <div class="col-lg-6 col-md-6 col-sm-8 col-xs-12">
                                        <div class="pull-right milestonedetail">
                                            <span class="milestonelegendheading"><b>Milestone Legend:</b></span>
                                            <span style="background-color: #3d709b;" class="legendmilestone">Planned</span>
                                            <span style="background-color: #abc7dd;" class="legendmilestone">In Progress</span>
                                            <span style="background-color: #1f3a4f;" class="legendmilestone">Completed</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="panel-body nopadding">
                            <div class="col-lg-12 col-md-12 col-sm-12 table-responsive pull-left">
                                <table id="tblAppend" class="table">
                                    <thead>
                                        <tr>
                                            <th class="tableheading1">#</th>
                                            <th class="tableheading2">Name</th>
                                            <th class="tableheading3">Date</th>
                                            @*<th>End Date</th>*@
                                            <th class="tableheading4">% Comp.</th>
                                            <th class="tableheading5">Status</th>
                                            <th class="tableheading6"></th>
                                            <th class="tableheading7"></th>
                                        </tr>
                                    </thead>
                                    <tbody class="clsmilestonerow"></tbody>
                                </table>
                            </div>
                            <div class="col-lg-12 col-md-12 col-sm-12 table-responsive pull-left">
                                <table class="table" id="table-milestone-detail">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Name</th>
                                            <th>Date</th>
                                            <th>% Comp.</th>
                                            <th>Status</th>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="milestone-detail">
                                        <tr>
                                            <td colspan="4">No milestone(s) found.</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <input type="submit" id="submitBtn" class="btn btn-primary btnadd" style="color:white" value="Submit" />
                        <a class="btn btn-primary btnadd" id="cancelbtn" href="@Url.Action("index", "project")" style="color:white">Cancel</a>
                        <input id="hdnMsgBody" name="hdnMsgBody" type="hidden" />
                        <input type="hidden" id="hdnImagePath" name="hdnImagePath" />
                        <input type="hidden" id="hdnPercentage" name="hdnPercentage" />
                    </div>

                </div>
            </div>
        </div>
    </div>
}

<script type="text/javascript">
    var count = 1;
    var prescopevalue = '';
    var preschedulevalue = '';
    var preresourcevalue = '';
    var prefinancevalue = '';
    var imagePath = '';
  
    function milestonerowhtml_old() {
        var html = "";
        html += "<div class=\"col-md-12 form-group milestonerow\">";
        html += "<div class=\"col-md-2\"><span class=\"clslblmilestoneno\">" + count + "</span></div>";
        html += "<div class=\"col-md-2\"><input type=\"text\" class=\"form-control clsmilestonename\" /></div>";
        html += "<div class=\"col-md-2\"><input type=\"text\" class=\"form-control clsmilestonestart\" /></div>";
        html += "<div class=\"col-md-2\"><input type=\"text\" class=\"form-control clsmilestoneend\" /></div>";
        html += "<div class=\"col-md-2\"><input type=\"text\" class=\"form-control clsmilestonecomp\"/></div>";
        html += "<div class=\"col-md-2\">";
        if (count == 1) {
            //html += "<a class=\"btn btn-primary btn-xs pull-left dd-nodrag btnaddMilestone\" onclick=\"addnewmilestone()\">";
            //html += "<img src=\"/Images/add.png\" style=\"height:30px\" title=\"Add new\" />";
            //html += "</a>";
        }
        else {
            //html += "<a class=\"btn btn-primary btn-xs pull-left dd-nodrag btnaddMilestone\" onclick=\"addnewmilestone()\">";
            //html += "<img src=\"/Images/add.png\" style=\"height:30px\" title=\"Add new\" />";
            //html += "</a>";
            html += "<a class=\"btn btn-primary btn-xs pull-left dd-nodrag btndeleteMilestone\">";
            html += "<img src='@Url.Content("~/Images/delete.png")' style=\"height:30px\" title=\"Delete\" />";
            html += "</a>";
        }
        html += "</div></div>";
        return html;
    }
    $('#submitBtn').click(function () {

        var msgBody = '';
        var result = true;//formvalid();
        if (result == true) {
            if ($('#ScopeId').val() != prescopevalue) {
                msgBody += "Scope Id : " + getDropdownValueColorName(prescopevalue) + " to " + getDropdownValueColorName($('#ScopeId').val()) + " ";
            }

            if ($('#ScheduleId').val() != preschedulevalue) {
                msgBody += "Schedule Id : " + getDropdownValueColorName(preschedulevalue) + " to " + getDropdownValueColorName($('#ScheduleId').val()) + " ";
            }

            if ($('#ResourcesId').val() != preresourcevalue) {
                msgBody += "Resources Id : " + getDropdownValueColorName(preresourcevalue) + " to " + getDropdownValueColorName($('#ResourcesId').val()) + " ";
            }

            if ($('#FinancialId').val() != prefinancevalue) {
                msgBody += "Financial Id : " + getDropdownValueColorName(prefinancevalue) + " to " + getDropdownValueColorName($('#FinancialId').val()) + " ";
            }

            if (msgBody != '') {
                $('#PDFdiv').html();
                //console.log($('#PDFdiv').html());
                var pdfHtml = escape($('#PDFdiv').html());
                $('#PDFdiv').html(pdfHtml);
            }
            
            $('#hdnMsgBody').val(msgBody);
            var percComp = $('#spn-overall-complete').text();
            $('#hdnPercentage').val(percComp);
            $('#form1').submit();
           
        }
    });

  

    function getDropdownValueColorName(obj) {

        if (obj == 0) {
            return "Not Started";
        }
        else if (obj == 1) {
            return "Red";
        }
        else if (obj == 2) {
            return "Amber";
        }
        else if (obj == 3) {
            return "Green";
        }
        else if (obj == 4) {
            return "Completed";
        }
    }


    function getcurrentdate() {
        var date = new Date();
        var year = date.getFullYear();
        var month = (1 + date.getMonth()).toString();
        month = month.length > 1 ? month : '0' + month;
        var day = date.getDate().toString();
        day = day.length > 1 ? day : '0' + day;
        return month + '/' + day + '/' + year;
    }
    //To do : (1)add new <td> with addimg button(2) set width=150px of startdate,comp%
    function milestonerowhtml() {
        var projstartdate = $('#proj-startdate').html().trim().replace(/-/gi, "/");
        var startdateObj = new Date(projstartdate).toLocaleDateString("en-US");

        var html = "";
        html += "<tr class=\"milestonerow\">";
        html += "<td><span class=\"clslblmilestoneno\">" + count + "</span><input type=\"hidden\" id=\"hdn-milestoneid\" value=\"0\" /></td>";
        html += "<td><input type=\"text\" class=\"form-control clsmilestonename\" id=\"txtmilestonename" + count + "\" /><span id=\"spnmname" + count + "\" class=\"clsspnmname spnerror\"></span></td>";
        html += "<td ><input type=\"text\" class=\"form-control clsmilestonestart\" id=\"txtmilestonestart" + count + "\" value=\"" + projstartdate + "\"/><span id=\"spnmstart" + count + "\" class=\"clsspnmstart spnerror\"></span></td>";
        //html += "<td><input type=\"text\" class=\"form-control clsmilestoneend\" id=\"txtmilestoneend" + count + "\" value=\"" + currentdate + "\"/><span id=\"spnmend" + count + "\" class=\"clsspnmend spnerror\"></span></td>";
        html += "<td ><input type=\"text\" class=\"form-control clsmilestonecomp\" id=\"txtmilestonecomp" + count + "\" maxlength=\"3\" onkeydown=\"return isNumericValue(event.keyCode);\" onkeyup=\"return isPercentageValue(this);\" value=\"0\"/><span id=\"spnmcomp" + count + "\" class=\"clsspnmcomp spnerror\"></span></td>";
        html += "<td><input type=\"radio\" class=\"color-full3\" value=\"3\"  id=\"completedradio" + count + "\" name=\"radiostatus\" /><label id=\"completedLabel" + count + "\" class=\"radio3\"></label><input type=\"radio\" class=\"color-full2\" value=\"2\" id=\"inprogressradio" + count + "\" name=\"radiostatus\" /><label id=\"inprogressLabel" + count + "\" class=\"radio2\"></label><input type=\"radio\" value=\"1\" class=\"color-full\"  id=\"plannedradio" + count + "\" checked=\"checked\"  name=\"radiostatus\" /><label id=\"plannedLabel" + count + "\" class=\"radio\"></label></td>";
        html += "<td><a onclick=\"addnewmilestone()\" class=\"btn btn-primary btn-xs dd-nodrag btnaddMilestone\"><img id=\"saveImageIcon\" title=\"Add Milestone\" style=\"height:30px\" src='@Url.Content("~/Images/add.png")'></a></td>";
        html += "<td>";
        html += "<a class=\"btn btn-primary btn-xs pull-left dd-nodrag btnCancelMilestone\" onclick=\"removemilestone()\">";
        html += "<img src='@Url.Content("~/Images/delete.png")' style=\"height:30px\" title=\"Cancel\" />";
        html += "</a>";
        if (count == 1) {
        }
        else {
            html += "<a class=\"btn btn-primary btn-xs pull-left dd-nodrag btndeleteMilestone\" onclick=\"removemilestone(this)\">";
            html += "<img src='@Url.Content("~/Images/delete.png")' style=\"height:30px\" title=\"Delete\" />";
            html += "</a>";
        }
        html += "</td></tr>";
        return html;
    }

    function emailrowhtml() {
        var html = "";
        html += "<tr class=\"emailrow\">";
        html += "<td><span class=\"clslblmilestoneno\">" + count + "</span><input type=\"hidden\" id=\"hdn-milestoneid\" value=\"0\" /></td>";
        html += "<td ><input type=\"text\" class=\"form-control clsemailcomp\" id=\"txtemailcomp" + count + "\" /><span id=\"spnemailcomp" + count + "\" class=\"clsspnemailcomp spnerror\"></span></td>";
        html += "<td><a onclick=\"saveEmail()\" class=\"btn btn-primary btn-xs dd-nodrag btnsaveEmail\"><img title=\"Save Email\" style=\"height:30px\" src='@Url.Content("~/Images/add.png")'></a> </td>";
        html += "<td>";
        html += "</td></tr>";
        return html;
    }

    function removeEmail() {
        $('#txtemailcomp1').val("");
    }

    function saveEmail() {
        if (emailformvalid()) {
            var email = "";

            $("#tblEmail  tbody  tr").each(function (index) {
                email = $(this).find(".clsemailcomp").val();
            });

            $.ajax({
                type: "POST",
                url: "@Url.Content("~/Project/SaveEmail")",
                dataType: "json",
                data: {
                    email: email,
                    ID: $("#ID").val(),
                },
                processData: true,
                success: function (data) {
                    if (data) {
                        LoadEmail();
                        removeEmail();
                    }

                },
                error: function (xhr, ajaxOptions, error) {
                    if (xhr.status == 200) {
                        LoadEmail();
                        removeEmail();

                    }
                    else {
                        alert("Sorry,We are unable to process your request!");
                    }
                }
            });
        }
    }


    function adddefaultmilestone() {
        var mhtml = milestonerowhtml();
        $('.clsmilestonerow').html(mhtml);
    }

    function adddefaultemail() {
        var ehtml = emailrowhtml();
        $('.clsemailrow').html(ehtml);
    }

    function addnewmilestone() {
        if (formvalid()) {
            var milestonename = "";
            var milestonestart = "";
            var milestonecomp = "";

            $("#tblAppend  tbody  tr").each(function (index) {
                milestonename = $(this).find(".clsmilestonename").val();
                milestonestart = $(this).find(".clsmilestonestart").val();
                milestonecomp = $(this).find(".clsmilestonecomp").val();
                milestonestatus = $(this).find("input[name='radiostatus']:checked").val();
            });

            $.ajax({
                type: "POST",
                url: "@Url.Content("~/Project/AddMilestone")",
                dataType: "json",
                data: {
                    milestonename: milestonename,
                    milestonestart: milestonestart,
                    milestonecomp: milestonecomp,
                    milestonestatus: milestonestatus,
                    ID: $("#ID").val(),
                    milestoneid: $('#hdn-milestoneid').val()
                },
                processData: true,
                success: function (data) {
                    var oldsrc = '@Url.Content("~/Images/add.png")';
                    $('#saveImageIcon').attr("src", oldsrc);
                    $('#saveImageIcon').attr("title", "Add Milestone");
                    LoadMileStones();
                    removemilestone();
                },
                error: function (xhr, ajaxOptions, error) {
                    var oldsrc = '@Url.Content("~/Images/add.png")';
                    $('#saveImageIcon').attr("src", oldsrc);
                    $('#saveImageIcon').attr("title", "Add Milestone");
                    if (xhr.status == 200) {
                        LoadMileStones();
                        removemilestone();
                    }
                    else {
                        alert("Sorry,We are unable to process your request!");
                    }
                }
            });
        }
    }

    function removemilestone() {
        var projstartdate = $('#proj-startdate').html().trim().replace(/-/gi, "/");
        $('#txtmilestonename1').val("");
        $('#txtmilestonestart1').val(projstartdate);
        $('#txtmilestonecomp1').val(0);
        $("#plannedradio1").prop("checked", true);
        $('#hdn-milestoneid').val("0");
    }

    function LoadEmail() {
        var projectId = $('#ID').val();
        $.ajax({
            type: "POST",
            url: "@Url.Content("~/Project/GetEmail")",
            contentType: "application/json;charset=utf-8;",
            data: '{"id":' + projectId + '}',
            dataType: "json",
            success: function (data) {
                if (data != null && data.length > 0) {
                    var tempHTML = "";
                    for (var i = 0; i < data.length; i++) {
                        tempHTML = tempHTML + "<tr id=\"" + data[i].ID + "\">";
                        tempHTML = tempHTML + "<td>" + parseInt(i + 1) + "</td>";
                        tempHTML = tempHTML + "<td class=\"email\">" + data[i].Email + "</td>";
                        tempHTML = tempHTML + "<td><a data-id=\"" + data[i].ID + "\" id=\"remove-email\" href='#'><i class='fa fa-trash-o' ></i></a></td>";
                        tempHTML = tempHTML + "</tr>";
                    }
                    $("#email-detail").html(tempHTML);
                }
                else {
                    tempHTML = "<tr><td>No Email Found.</td></tr>";
                    $("#email-detail").html(tempHTML);
                }

            },
            error: function (xhr, status) { alert("Some Error produces on server"); }

        });
    }

    function initializedatepicker() {
        
        var projstartdate = $('#proj-startdate').html().trim().replace(/-/gi, "/");
        var startdateObj = new Date(projstartdate).toLocaleDateString("en-US");
        var projenddate = $('#proj-enddate').html().trim().replace(/-/gi, "/");
        var enddateObj = new Date(projenddate).toLocaleDateString("en-US");
        var dateFormat = 'mm-dd-yyyy';
        var from = $("#txtmilestonestart" + count)
                .datepicker({
                    changeMonth: true,
                    changeYear: true,
                    minDate: new Date(projstartdate),
                    maxDate: new Date(projenddate),
                }).on("change", function () {
                    if ($(this).val() == null || $(this).val() == '') {
                        $(this).parent().find('.clsspnmstart').html("Please enter start date.");
                        $(this).focus();
                    }
                    else {
                        $(this).parent().find('.clsspnmstart').html('');
                    }
                    console.log("before to" + $(this).val());
                    console.log("after to" + $(this).val());
                })
        function getDate(element) {

            var date;
            try {
                date = $.datepicker.parseDate(dateFormat, element.value);
            } catch (error) {
                alert(error);
                date = null;
            }

            return date;
        }
    }

    function pageloadDropdownColor() {
        prescopevalue = $('#ScopeId').val();
        preschedulevalue = $('#ScheduleId').val();
        preresourcevalue = $('#ResourcesId').val();
        prefinancevalue = $('#FinancialId').val();
        updateragstatus("#ScopeId");
        updateragstatus("#ScheduleId");
        updateragstatus("#ResourcesId");
        updateragstatus("#FinancialId");


    }

    function changeColor(obj) {

        if ($(obj).val() == '1') {
            $(obj).css('background-color', 'red').css('border', '1px solid #000').css('color', '#fff').find("option").css('background-color', 'white').css('color', '#000')
        }
        if ($(obj).val() == '2') {
            $(obj).css('background-color', '#FFC200').css('border', '1px solid #000').css('color', '#000').find("option").css('background-color', 'white').css('color', '#000')
        }
        if ($(obj).val() == '3') {
            $(obj).css('background-color', 'green').css('border', '1px solid #000').css('color', '#fff').find("option").css('background-color', 'white').css('color', '#000')
        }
        if ($(obj).val() == '4' || $(obj).val() == "") {

            $(obj).css('background-color', 'gray').css('border', '1px solid #000').css('color', '#000').find("option").css('background-color', 'white').css('color', '#000')
        }
        if ($(obj).val() == '0' || $(obj).val() == "") {

            $(obj).css('background-color', 'white').css('border', '1px solid #000').css('color', '#000').find("option").css('background-color', 'white').css('color', '#000')
        }
    }

    function updateragstatus(obj) {

        var regbgcolor = "";
        //if ($('#MilestoneScopeId').val() != '' && $('#MilestoneScheduleId').val() != '' && $('#MilestoneResourceId').val() != '' && $('#MilestoneFinancialId').val() != '')
        // {
        //alert($(obj).val());
        changeColor(obj);

        if ($('#ScopeId').val() == '1' || $('#ScheduleId').val() == '1' || $('#ResourcesId').val() == '1' || $('#FinancialId').val() == '1') {
            regbgcolor = "Red";
        }
        if (regbgcolor == '') {
            if ($('#ScopeId').val() == '2' || $('#ScheduleId').val() == '2' || $('#ResourcesId').val() == '2' || $('#FinancialId').val() == '2') {
                regbgcolor = "#FFC200";
            }
        }
        if (regbgcolor == '') {
            if ($('#ScopeId').val() == '3' && $('#ScheduleId').val() == '3' && $('#ResourcesId').val() == '3' && $('#FinancialId').val() == '3') {
                regbgcolor = "Green";
            }
        }
        if (regbgcolor == '') {
            if ($('#ScopeId').val() == '4' && $('#ScheduleId').val() == '4' && $('#ResourcesId').val() == '4' && $('#FinancialId').val() == '4') {
                regbgcolor = "gray";
            }
        }




        //}
        $('.clsrag').css("background", regbgcolor);

        return false;
    }
    function SendMail() {
        var projectId = $('#ID').val();
        $.ajax({
            type: "POST",
            url: "@Url.Content("~/Project/SendMail")",
            contentType: "application/json;charset=utf-8;",
            data: '{"id":' + projectId + '}',
            dataType: "json",
            success: function (data) {

            },
            error: function (xhr, status) { alert("Some Error produces on server"); }

        });
    }

    function checkrowvalidation(obj, setfocus) {
        var flag = true;


        $(obj).find('.clsmilestonecomp').each(function () {
            if ($(this).val() == null || $(this).val() == '') {
                $(this).parent().find('.clsspnmcomp').html("Please enter % completed.");
                flag = false;
                if (setfocus) {
                    $(this).focus();
                }
            }
            else {
                $(this).parent().find('.clsspnmcomp').html('');
            }
        })

        $(obj).find('.clsmilestonestart').each(function () {
            if ($(this).val() == null || $(this).val() == '') {
                $(this).parent().find('.clsspnmstart').html("Please enter start date.");
                flag = false;
                //if (setfocus) {
                //    $(this).focus();
                //}
            }
            else {
                //write validation code later...OR disalble the textbox
            }
        })

        $(obj).find('.clsmilestonename').each(function () {
            if ($(this).val() == null || $(this).val() == '') {
                $(this).parent().find('.clsspnmname').html("Please enter milestone name.");
                flag = false;
                if (setfocus) {
                    $(this).focus();
                }
            }
            else {
                $(this).parent().find('.clsspnmname').html('');
            }
        })

        return flag;
    }

    function formvalid() {
        var flag = true;
        $('.clsspnmstart').html('');
        $('.clsspnmname').html('');
        $('.clsspnmcomp').html('');
        //$($(".milestonerow").get().reverse()).each(function () {
        $(".milestonerow").each(function () {
            if (flag) {
                flag = checkrowvalidation(this, true);

            }
            else { checkrowvalidation(this, false); }

        })
        return flag;
    }
    function emailformvalid() {
        var flag = true;

        $(".emailrow").each(function () {
            if (flag) {
                flag = checkemailrowvalidation(this, true);

            }
            else { checkemailrowvalidation(this, false); }

        })
        return flag;
    }

    function checkemailrowvalidation(obj, setfocus) {
        var flag = true;

        $(obj).find('.clsemailcomp').each(function () {
            if ($(this).val() == null || $(this).val() == '') {
                $(this).parent().find('.clsspnemailcomp').html("Please enter Email.");
                flag = false;
                if (setfocus) {
                    $(this).focus();
                }
            }
            else {
                emailtxt = $(this).val();
                if (validateEmail(emailtxt)) {
                    $(this).parent().find('.clsspnemailcomp').html('');
                }
                else {
                    $(this).parent().find('.clsspnemailcomp').html("Please enter valid Email.");
                    flag = false;
                    if (setfocus) {
                        $(this).focus();
                    }
                }

            }
        })

        return flag;
    }

    function validateEmail(email) {
        var re = /^[a-zA-Z0-9_.-]+@@[a-zA-Z0-9]+[a-zA-Z0-9.-]+[a-zA-Z0-9]+.[a-z]{2,4}$/;
        return re.test(email);
    }


    $('body').on('keyup', '.clsmilestonename', function () {
        if ($(this).val() == null || $(this).val() == '') {
            $(this).parent().find('.clsspnmname').html("Please enter milestone name.");
            $(this).focus();
        }
        else {
            $(this).parent().find('.clsspnmname').html('');
        }
    })


    function isPercentageValue(obj) {
        if ($(obj).val() > 100) {
            $(obj).val($(obj).val().slice(0, -1));
        }
        if ($(obj).val() == null || $(obj).val() == '') {
            $(obj).parent().find('.clsspnmcomp').html("Please enter % completed.");
            $(obj).focus();
        }
        else {
            $(obj).parent().find('.clsspnmcomp').html('');
        }
    }
    $(document).ready(function () {
        adddefaultmilestone();
        initializedatepicker();
        pageloadDropdownColor();
        adddefaultemail();
        var PID = $('#ID').val();
        $('#PDFdiv').html('@Html.Raw(HttpUtility.JavaScriptStringEncode(Html.Action("PdfDetail", "ProjectSummary", new { id = @Model.ID }).ToString()))');

        $('#plannedLabel1').on('click', function () {
            $("#plannedradio1").click();
        });

        $('#inprogressLabel1').on('click', function () {
            $("#inprogressradio1").click();
        });

        $('#completedLabel1').on('click', function () {
            $("#completedradio1").click();
        });
    })
</script>

<script id="milestone-section" type="text/javascript">
    $(document).ready(function () {

        LoadMileStones();
        LoadEmail();
        GetOverAllPercentageForProject();

        $('#emailchkbox').click(function () {
            if ($('#emailchkbox').is(':checked')) {
                $('#emailDiv').show();
                $('#emailListDiv').show();
            }
            else {
                $('#emailDiv').hide();
                $('#emailListDiv').hide();
            }
        });

        //$('#edit-milestone').live("click", function () {
        $(document).on('click', "#edit-milestone", function () {
            var milestoneId = $(this).attr("data-id"); console.log(milestoneId);
            $('#txtmilestonename1').val($('#' + milestoneId + " .name").html());
            var milstartdate = $('#' + milestoneId + " .sdate").html().trim().replace(/-/gi, "/");
            //var startdateObj = new Date(milstartdate).toLocaleDateString("en-US");
            //$('#txtmilestonestart1').val(startdateObj);
           
            $('#txtmilestonestart1').val(milstartdate);
            $('#txtmilestonecomp1').val($('#' + milestoneId + " .complete").html());
            $('#hdn-milestoneid').val(milestoneId);
            var newsrc = '@Url.Content("~/Images/edit.png")';
            $('#saveImageIcon').attr("src", newsrc);
            $('#saveImageIcon').attr("title", "Update Milestone");
            var statusvalue = $(this).attr("data-status");
            $("input[name=radiostatus][value=" + statusvalue + "]").prop('checked', true);
        });

        $(document).on("click", "#remove-milestone", function () {
            var milestoneId = $(this).attr("data-id"); console.log(milestoneId);
            DeleteMileStone(milestoneId);
        });

        $(document).on("click", "#remove-email", function () {
            var emailId = $(this).attr("data-id"); console.log(emailId);
            DeleteEmail(emailId);
        });
    });



    function LoadMileStones() {
        var projectId = $('#ID').val();
        $.ajax({
            type: "POST",
            url: "@Url.Content("~/Project/GetMileStones")",
           // url: "/Project/GetMileStones",
            contentType: "application/json;charset=utf-8;",
            data: '{"id":' + projectId + '}',
            dataType: "json",
            success: function (data) {
                if (data != null && data.length > 0) {
                    var tempHTML = "";
                    for (var i = 0; i < data.length; i++) {
                        tempHTML = tempHTML + "<tr id=\"" + data[i].ID + "\">";
                        tempHTML = tempHTML + "<td>" + parseInt(i+1) + "</td>";
                        tempHTML = tempHTML + "<td class=\"name\">" + data[i].Name + "</td>";
                        tempHTML = tempHTML + "<td class=\"sdate\">" + data[i].StartDateString + "</td>";
                        tempHTML = tempHTML + "<td class=\"complete\">" + data[i].Complete + "</td>";
                        tempHTML = tempHTML + "<td class=\"status\" style=\"background-color:" + GetStatusColor(data[i].MilestoneStatus) + ";width:40px;\"></td>";
                        tempHTML = tempHTML + "<td ><a style=\"float:right\" data-id=\"" + data[i].ID + "\" data-status=\"" + data[i].MilestoneStatus + "\" id=\"edit-milestone\" href='#'><i class='fa fa-pencil'></i></a></td>";
                        tempHTML = tempHTML + "<td><a data-id=\"" + data[i].ID + "\" id=\"remove-milestone\" href='#'><i class='fa fa-trash-o'></i></a></td>";
                        tempHTML = tempHTML + "</tr>";
                    }
                    $("#milestone-detail").html(tempHTML);
                }
                else {
                    tempHTML = "<tr><td>No Milestone(s) Found.</td></tr>";
                    $("#milestone-detail").html(tempHTML);
                }
                GetOverAllPercentageForProject();
            },
            error: function (xhr, status) { alert("Some Error produces on server"); }

        });
    }

    function GetStatusColor(obj) {
        if (obj == "1") {
            return "#3d709b";  //Not Started
        }
        if (obj == "2") {
            return "#abc7dd"; //In Progress
        }
        if (obj == "3") {
            return "#1f3a4f"; //Completed
        }
        if (obj == "0") {
            return "#FFF";
        }
    }


    function DeleteMileStone(milestoneId) {
        $.ajax({
            type: "POST",
            url: "@Url.Content("~/Project/RemoveMileStone")",
           // url: "/Project/RemoveMileStone",
            dataType: "json",
            //contentType: "application/json",
            data: {
                id: milestoneId,
                projectId: $('#ID').val()
            },
            processData: true,
            success: function (data) {
                LoadMileStones();
               // alert("Milestone(s) deleted successfully.");

                // var url = "/Project/Index";
                // window.location.href = url;
            },
            error: function (xhr, ajaxOptions, error) {
                if (xhr.status == 200) {
                    LoadMileStones();
                    //alert("Milestone(s) deleted successfully.");
                    //var url = "/Project/Index";
                    // window.location.href = url;
                }
                else {
                    alert(xhr.status);
                }
                //alert(error);
            }
        });
    }


    function DeleteEmail(emailId) {
        $.ajax({
            type: "POST",
            url: "@Url.Content("~/Project/DeleteMultiEmail")",
           // url: "/Project/DeleteMultiEmail",
            dataType: "json",
            data: {
                id: emailId,
                projectId: $('#ID').val()
            },
            processData: true,
            success: function (data) {

                LoadEmail();

            },
            error: function (xhr, ajaxOptions, error) {
                if (xhr.status == 200) {
                    LoadEmail();
                }
                else {
                    alert(xhr.status);
                }

            }
        });
    }


    function GetOverAllPercentageForProject() {
        var projectId = $('#ID').val();
        $.ajax({
            type: "POST",
            url: "@Url.Content("~/Project/GetOverAllPercentageForProject")",
            //url: "/Project/GetOverAllPercentageForProject",
            contentType: "application/json;charset=utf-8;",
            data: '{"projectId":' + projectId + '}',
            dataType: "json",
            success: function (data) {
                $('#spn-overall-complete').text(data);
              
            },
            error: function (xhr, status) { alert("Some Error produces on server"); }

        });
    }

</script>

<script>
    function dataURLtoBlob(dataURL) {
        var binary = atob(dataURL.split(',')[1]);
        var array = [];
        for (var i = 0; i < binary.length; i++) {
            array.push(binary.charCodeAt(i));
        }
        return new Blob([new Uint8Array(array)], { type: 'image/png' });
    }
</script>
                                               
<style>
    /*ONE*/
    input[type="radio"].color-full {
        opacity: 0;
        position: absolute;
        display: inline-block;
    }

        input[type="radio"].color-full + label.radio {
            cursor: pointer;
            display: inline-block;
        }

            input[type="radio"].color-full + label.radio:after {
                display: inline-block;
                content: "";
                text-align: center;
                color: #ccc;
                background: transparent url(/DCSPP/Images/radios.png) 100% 60% no-repeat;
                width: 20px;
                height: 20px;
                vertical-align: middle;
                margin: 0 2px;
                border-radius: 50%;
                border: 1px solid grey;
            }

        input[type="radio"].color-full:checked + label.radio:after {
            color: #fff;
            background: transparent url(/DCSPP/Images/radios.png) 100% 40% no-repeat;
            border-color: white;
            height: 22px;
            width: 21px;
        }

    /*TWO*/
    input[type="radio"].color-full2 {
        opacity: 0;
        position: absolute;
        display: inline-block;
    }

        input[type="radio"].color-full2 + label.radio2 {
            cursor: pointer;
            display: inline-block;
        }

            input[type="radio"].color-full2 + label.radio2:after {
                display: inline-block;
                content: "";
                text-align: center;
                color: #ccc;
                background: transparent url(/DCSPP/Images/radios.png) 100% 100% no-repeat;
                width: 20px;
                height: 20px;
                vertical-align: middle;
                margin: 0 2px;
                border-radius: 50%;
                border: 1px solid grey;
            }

        input[type="radio"].color-full2:checked + label.radio2:after {
            color: #fff;
            background: transparent url(/DCSPP/Images/radios.png) 100% 80% no-repeat;
            border-color: white;
            height: 22px;
            width: 21px;
        }

    /*TWO*/
    input[type="radio"].color-full3 {
        opacity: 0;
        position: absolute;
        display: inline-block;
    }

        input[type="radio"].color-full3 + label.radio3 {
            cursor: pointer;
            display: inline-block;
        }

            input[type="radio"].color-full3 + label.radio3:after {
                display: inline-block;
                content: "";
                text-align: center;
                color: #ccc;
                background: transparent url(/DCSPP/Images/radios.png) 100% 20% no-repeat;
                width: 20px;
                height: 20px;
                vertical-align: middle;
                margin: 0 2px;
                border-radius: 50%;
                border: 1px solid grey;
            }

        input[type="radio"].color-full3:checked + label.radio3:after {
            color: #fff;
            background: transparent url(/DCSPP/Images/radios.png) 100% 0 no-repeat;
            border-color: white;
            height: 22px;
            width: 21px;
        }
</style>
